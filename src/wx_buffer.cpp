//=============================================================================
// Auxiliary library for Windows API (C++)
//                                                     Copyright (c) 2007 MAYO.
//=============================================================================

#define WIN32_LEAN_AND_MEAN

#include <windows.h>
#include "wx_misc.h"
#include "wx_buffer.h"

namespace wx {

//-----------------------------------------------------------------------------
// コンストラクタ
//-----------------------------------------------------------------------------
Buffer::Buffer()
	: m_data(NULL)
	, m_size(0)
{
}

//-----------------------------------------------------------------------------
// デストラクタ
//-----------------------------------------------------------------------------
Buffer::~Buffer()
{
	Finalize();
}

//-----------------------------------------------------------------------------
// バッファ確保
//-----------------------------------------------------------------------------
bool Buffer::Initialize(UINT size)
{
	// 初期化済みな時は、一度解放する
	Finalize();

	m_data = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, size);
	if (!m_data) {
		return false;
	}

	m_size = size;
	return true;
}

//-----------------------------------------------------------------------------
// バッファ解放
//-----------------------------------------------------------------------------
void Buffer::Finalize()
{
	if (m_data) {
		HeapFree(GetProcessHeap(), 0, m_data);
	}

	m_data = NULL;
	m_size = 0;
}

//-----------------------------------------------------------------------------
// バッファのメモリポインタ取得
//-----------------------------------------------------------------------------
void* Buffer::GetData()
{
	return m_data;
}

//-----------------------------------------------------------------------------
// バッファのサイズ取得
//-----------------------------------------------------------------------------
UINT Buffer::GetSize() const
{
	return m_size;
}

//-----------------------------------------------------------------------------
// バッファのクリア
//-----------------------------------------------------------------------------
void Buffer::Clear()
{
	ZeroMemory(m_data, m_size);
}

//-----------------------------------------------------------------------------
// バッファ全体を指定の値で埋める
//-----------------------------------------------------------------------------
void Buffer::Fill(BYTE value)
{
	FillMemory(m_data, m_size, value);
}

//-----------------------------------------------------------------------------
// 指定範囲を指定の値で埋める
//-----------------------------------------------------------------------------
void Buffer::Fill(UINT size, BYTE value)
{
	WX_ASSERT(size <= m_size, "[ERROR] サイズが大きすぎます！");
	FillMemory(m_data, Min(size, m_size), value);
}

//-----------------------------------------------------------------------------
// 指定バッファに指定バイト数分コピーする
//-----------------------------------------------------------------------------
void Buffer::CopyTo(void* dest, UINT size) const
{
	WX_ASSERT(size <= m_size, "[ERROR] サイズが大きすぎます！");
	CopyMemory(dest, m_data, Min(size, m_size));
}

} //namespace wx
